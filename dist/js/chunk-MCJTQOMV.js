import{A as Se,B as m,D as O,G as le,I,J as Ie,L as Be,P as Fe,S as he,c as S,d as $,e as d,f as g,g as be,i as Pe,o as L,p as Z,q as xe,r as we,s as A,t as ke,y as C,z as Me}from"./chunk-P6I444PJ.js";var F=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(F||{});var U=class{constructor(e,i=null,s=0,o=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=e,this._context=i,this.priority=s,this._once=o}match(e,i=null){return this._fn===e&&this._context===i}emit(e){this._fn&&(this._context?this._fn.call(this._context,e):this._fn(e));let i=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),i}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let i=this.next;return this.next=e?null:i,this.previous=null,i}};var T=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new U(null,null,1/0),this.deltaMS=1/T.targetFPMS,this.elapsedMS=1/T.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=F.NORMAL){return this._addListener(new U(t,e,i))}addOnce(t,e,i=F.NORMAL){return this._addListener(new U(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){let o=t-this._lastFrame|0;if(o<this._minElapsedMS)return;this._lastFrame=t-o%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*T.targetFPMS;let i=this._head,s=i.next;for(;s;)s=s.emit(this);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){let e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,T.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{let e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!T._shared){let t=T._shared=new T;t.autoStart=!0,t._protected=!0}return T._shared}static get system(){if(!T._system){let t=T._system=new T;t.autoStart=!0,t._protected=!0}return T._system}},b=T;b.targetFPMS=.06;var W=class{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,F.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?b.shared:new b,e.autoStart&&this.start()}static destroy(){if(this._ticker){let e=this._ticker;this.ticker=null,e.destroy()}}};W.extension=d.Application;var z=class{static init(e){Object.defineProperty(this,"resizeTo",{set(i){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=i,i&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{!this._resizeTo||(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this._cancelResize();let i,s;if(this._resizeTo===globalThis.window)i=globalThis.innerWidth,s=globalThis.innerHeight;else{let{clientWidth:o,clientHeight:r}=this._resizeTo;i=o,s=r}this.renderer.resize(i,s),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}};z.extension=d.Application;g.add(z);g.add(W);var v=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(v||{});var j=(t,e)=>{let i=e.split("?")[1];return i&&(t+=`?${i}`),t};function w(t){if(typeof t!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function H(t){return t.split("?")[0].split("#")[0]}function rt(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function nt(t,e,i){return t.replace(new RegExp(rt(e),"g"),i)}function at(t,e){let i="",s=0,o=-1,r=0,a=-1;for(let n=0;n<=t.length;++n){if(n<t.length)a=t.charCodeAt(n);else{if(a===47)break;a=47}if(a===47){if(!(o===n-1||r===1))if(o!==n-1&&r===2){if(i.length<2||s!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){let h=i.lastIndexOf("/");if(h!==i.length-1){h===-1?(i="",s=0):(i=i.slice(0,h),s=i.length-1-i.lastIndexOf("/")),o=n,r=0;continue}}else if(i.length===2||i.length===1){i="",s=0,o=n,r=0;continue}}e&&(i.length>0?i+="/..":i="..",s=2)}else i.length>0?i+=`/${t.slice(o+1,n)}`:i=t.slice(o+1,n),s=n-o-1;o=n,r=0}else a===46&&r!==-1?++r:r=-1}return i}var _={toPosix(t){return nt(t,"\\","/")},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},isBlobUrl(t){return t.startsWith("blob:")},hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){w(t),t=this.toPosix(t);let e=/^file:\/\/\//.exec(t);if(e)return e[0];let i=/^[^/:]+:\/{0,2}/.exec(t);return i?i[0]:""},toAbsolute(t,e,i){if(w(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;let s=H(this.toPosix(e??m.ADAPTER.getBaseUrl())),o=H(this.toPosix(i??this.rootname(s)));return t=this.toPosix(t),t.startsWith("/")?_.join(o,t.slice(1)):this.isAbsolute(t)?t:this.join(s,t)},normalize(t){if(w(t),t.length===0)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;t=this.toPosix(t);let e="",i=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));let s=t.endsWith("/");return t=at(t,!1),t.length>0&&s&&(t+="/"),i?`/${t}`:e+t},isAbsolute(t){return w(t),t=this.toPosix(t),this.hasProtocol(t)?!0:t.startsWith("/")},join(...t){if(t.length===0)return".";let e;for(let i=0;i<t.length;++i){let s=t[i];if(w(s),s.length>0)if(e===void 0)e=s;else{let o=t[i-1]??"";this.extname(o)?e+=`/../${s}`:e+=`/${s}`}}return e===void 0?".":this.normalize(e)},dirname(t){if(w(t),t.length===0)return".";t=this.toPosix(t);let e=t.charCodeAt(0),i=e===47,s=-1,o=!0,r=this.getProtocol(t),a=t;t=t.slice(r.length);for(let n=t.length-1;n>=1;--n)if(e=t.charCodeAt(n),e===47){if(!o){s=n;break}}else o=!1;return s===-1?i?"/":this.isUrl(a)?r+t:r:i&&s===1?"//":r+t.slice(0,s)},rootname(t){w(t),t=this.toPosix(t);let e="";if(t.startsWith("/")?e="/":e=this.getProtocol(t),this.isUrl(t)){let i=t.indexOf("/",e.length);i!==-1?e=t.slice(0,i):e=t,e.endsWith("/")||(e+="/")}return e},basename(t,e){w(t),e&&w(e),t=H(this.toPosix(t));let i=0,s=-1,o=!0,r;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let a=e.length-1,n=-1;for(r=t.length-1;r>=0;--r){let h=t.charCodeAt(r);if(h===47){if(!o){i=r+1;break}}else n===-1&&(o=!1,n=r+1),a>=0&&(h===e.charCodeAt(a)?--a===-1&&(s=r):(a=-1,s=n))}return i===s?s=n:s===-1&&(s=t.length),t.slice(i,s)}for(r=t.length-1;r>=0;--r)if(t.charCodeAt(r)===47){if(!o){i=r+1;break}}else s===-1&&(o=!1,s=r+1);return s===-1?"":t.slice(i,s)},extname(t){w(t),t=H(this.toPosix(t));let e=-1,i=0,s=-1,o=!0,r=0;for(let a=t.length-1;a>=0;--a){let n=t.charCodeAt(a);if(n===47){if(!o){i=a+1;break}continue}s===-1&&(o=!1,s=a+1),n===46?e===-1?e=a:r!==1&&(r=1):e!==-1&&(r=-1)}return e===-1||s===-1||r===0||r===1&&e===s-1&&e===i+1?"":t.slice(e,s)},parse(t){w(t);let e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;t=H(this.toPosix(t));let i=t.charCodeAt(0),s=this.isAbsolute(t),o,r="";e.root=this.rootname(t),s||this.hasProtocol(t)?o=1:o=0;let a=-1,n=0,h=-1,c=!0,l=t.length-1,p=0;for(;l>=o;--l){if(i=t.charCodeAt(l),i===47){if(!c){n=l+1;break}continue}h===-1&&(c=!1,h=l+1),i===46?a===-1?a=l:p!==1&&(p=1):a!==-1&&(p=-1)}return a===-1||h===-1||p===0||p===1&&a===h-1&&a===n+1?h!==-1&&(n===0&&s?e.base=e.name=t.slice(1,h):e.base=e.name=t.slice(n,h)):(n===0&&s?(e.name=t.slice(1,a),e.base=t.slice(1,h)):(e.name=t.slice(n,a),e.base=t.slice(n,h)),e.ext=t.slice(a,h)),e.dir=this.dirname(t),r&&(e.dir=r+e.dir),e},sep:"/",delimiter:":"};var G=class extends Ie{constructor(e){super();let{textures:i,data:s}=e;Object.keys(s.pages).forEach(r=>{let a=s.pages[parseInt(r,10)],n=i[a.id];this.pages.push({texture:n})}),Object.keys(s.chars).forEach(r=>{let a=s.chars[r],n=i[a.page].source,h=new L(a.x/n.width,a.y/n.height,a.width/n.width,a.height/n.height),c=new I({source:n,layout:{frame:h}});this.chars[r]={id:r.codePointAt(0),xOffset:a.xOffset,yOffset:a.yOffset,xAdvance:a.xAdvance,kerning:a.kerning??{},texture:c}}),this.baseRenderedFontSize=s.fontSize;let o=this;o.baseMeasurementFontSize=s.fontSize,o.fontMetrics={ascent:0,descent:0,fontSize:s.fontSize},o.baseLineOffset=s.baseLineOffset,o.lineHeight=s.lineHeight,o.fontFamily=s.fontFamily,o.distanceField=s.distanceField??{type:"none",range:0}}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){let{texture:i}=this.pages[e];i.destroy(!0)}this.pages=null}};var Q={test(t){return typeof t=="string"&&t.startsWith("info face=")},parse(t){let e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(let p in e){let u=e[p].match(/^[a-z]+/gm)[0],f=e[p].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),E={};for(let ye in f){let _e=f[ye].split("="),st=_e[0],Ee=_e[1].replace(/"/gm,""),Te=parseFloat(Ee),ot=isNaN(Te)?Ee:Te;E[st]=ot}i[u].push(E)}let s={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[o]=i.info,[r]=i.common,[a]=i.distanceField??[];a&&(s.distanceField={range:parseInt(a.distanceRange,10),type:a.fieldType}),s.fontSize=parseInt(o.size,10),s.fontFamily=o.face,s.lineHeight=parseInt(r.lineHeight,10);let n=i.page;for(let p=0;p<n.length;p++)s.pages.push({id:parseInt(n[p].id,10)||0,file:n[p].file});let h={};s.baseLineOffset=s.lineHeight-parseInt(r.base,10);let c=i.char;for(let p=0;p<c.length;p++){let u=c[p],f=parseInt(u.id,10),E=u.letter??u.char;E==="space"&&(E=" "),h[f]=E,s.chars[E]={id:f,page:parseInt(u.page,10)||0,x:parseInt(u.x,10),y:parseInt(u.y,10),width:parseInt(u.width,10),height:parseInt(u.height,10),xOffset:parseInt(u.xoffset,10),yOffset:parseInt(u.yoffset,10),xAdvance:parseInt(u.xadvance,10),kerning:{}}}let l=i.kerning||[];for(let p=0;p<l.length;p++){let u=parseInt(l[p].first,10),f=parseInt(l[p].second,10),E=parseInt(l[p].amount,10);s.chars[h[f]].kerning[h[u]]=E}return s}};var ce={test(t){let e=t;return typeof e!="string"&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(t){let e={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},i=t.getElementsByTagName("info")[0],s=t.getElementsByTagName("common")[0],o=t.getElementsByTagName("distanceField")[0];o&&(e.distanceField={type:o.getAttribute("fieldType"),range:parseInt(o.getAttribute("distanceRange"),10)});let r=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),n=t.getElementsByTagName("kerning");e.fontSize=parseInt(i.getAttribute("size"),10),e.fontFamily=i.getAttribute("face"),e.lineHeight=parseInt(s.getAttribute("lineHeight"),10);for(let c=0;c<r.length;c++)e.pages.push({id:parseInt(r[c].getAttribute("id"),10)||0,file:r[c].getAttribute("file")});let h={};e.baseLineOffset=e.lineHeight-parseInt(s.getAttribute("base"),10);for(let c=0;c<a.length;c++){let l=a[c],p=parseInt(l.getAttribute("id"),10),u=l.getAttribute("letter")??l.getAttribute("char");u==="space"&&(u=" "),h[p]=u,e.chars[u]={id:p,page:parseInt(l.getAttribute("page"),10)||0,x:parseInt(l.getAttribute("x"),10),y:parseInt(l.getAttribute("y"),10),width:parseInt(l.getAttribute("width"),10),height:parseInt(l.getAttribute("height"),10),xOffset:parseInt(l.getAttribute("xoffset"),10),yOffset:parseInt(l.getAttribute("yoffset"),10),xAdvance:parseInt(l.getAttribute("xadvance"),10),kerning:{}}}for(let c=0;c<n.length;c++){let l=parseInt(n[c].getAttribute("first"),10),p=parseInt(n[c].getAttribute("second"),10),u=parseInt(n[c].getAttribute("amount"),10);e.chars[h[p]].kerning[h[l]]=u}return e}};var ue={test(t){return typeof t=="string"&&t.includes("<font>")?ce.test(m.ADAPTER.parseXML(t)):!1},parse(t){return ce.parse(m.ADAPTER.parseXML(t))}};var lt=[".xml",".fnt"],Le={extension:d.CacheParser,test:t=>t instanceof G,getCacheableAssets(t,e){let i={};return t.forEach(s=>{i[s]=e}),i[e.fontFamily]=e,i}},Ce={extension:{type:d.LoadParser,priority:v.Normal},test(t){return lt.includes(_.extname(t).toLowerCase())},async testParse(t){return Q.test(t)||ue.test(t)},async parse(t,e,i){let s=Q.test(t)?Q.parse(t):ue.parse(t),{src:o}=e,{pages:r}=s,a=[];for(let l=0;l<r.length;++l){let p=r[l].file,u=_.join(_.dirname(o),p);u=j(u,o),a.push(u)}let n=await i.load(a),h=a.map(l=>n[l]);return new G({data:s,textures:h})},async load(t,e){return await(await m.ADAPTER.fetch(t)).text()},unload(t){t.destroy()}};var Oe={extension:d.CacheParser,test:t=>Array.isArray(t)&&t.every(e=>e instanceof I),getCacheableAssets:(t,e)=>{let i={};return t.forEach(s=>{e.forEach((o,r)=>{i[s+(r===0?"":r+1)]=o})}),i}};async function J(t){if("Image"in globalThis)return new Promise(e=>{let i=new Image;i.onload=()=>{e(!0)},i.onerror=()=>{e(!1)},i.src=t});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{let e=await(await fetch(t)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}var Ue={extension:{type:d.DetectionParser,priority:1},test:async()=>J("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter(e=>e!=="avif")};var Re=["png","jpg","jpeg"],De={extension:{type:d.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...Re],remove:async t=>t.filter(e=>!Re.includes(e))};var ht="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function R(t){return ht?!1:document.createElement("video").canPlayType(t)!==""}var Ne={extension:{type:d.DetectionParser,priority:0},test:async()=>R("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter(e=>e!=="mp4"&&e!=="m4v")};var We={extension:{type:d.DetectionParser,priority:0},test:async()=>R("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter(e=>e!=="ogv")};var ze={extension:{type:d.DetectionParser,priority:0},test:async()=>R("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter(e=>e!=="webm")};var je={extension:{type:d.DetectionParser,priority:0},test:async()=>J("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter(e=>e!=="webp")};function P(t,e){if(Array.isArray(e)){for(let i of e)if(t.startsWith(`data:${i}`))return!0;return!1}return t.startsWith(`data:${e}`)}function x(t,e){let i=t.split("?")[0],s=_.extname(i).toLowerCase();return Array.isArray(e)?e.includes(s):s===e}var ct=".json",ut="application/json",He={extension:{type:d.LoadParser,priority:v.Low},name:"loadJson",test(t){return P(t,ut)||x(t,ct)},async load(t){return await(await m.ADAPTER.fetch(t)).json()}};var dt=".txt",pt="text/plain",Ge={name:"loadTxt",extension:{type:d.LoadParser,priority:v.Low},test(t){return P(t,pt)||x(t,dt)},async load(t){return await(await m.ADAPTER.fetch(t)).text()}};var mt=["normal","bold","100","200","300","400","500","600","700","800","900"],ft=[".ttf",".otf",".woff",".woff2"],gt=["font/ttf","font/otf","font/woff","font/woff2"],At=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function vt(t){let e=_.extname(t),o=_.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)),r=o.length>0;for(let n of o)if(!n.match(At)){r=!1;break}let a=o.join(" ");return r||(a=`"${a.replace(/[\\"]/g,"\\$&")}"`),a}var yt=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function _t(t){return yt.test(t)?t:encodeURI(t)}var Xe={extension:{type:d.LoadParser,priority:v.Low},name:"loadWebFont",test(t){return P(t,gt)||x(t,ft)},async load(t,e){let i=m.ADAPTER.getFontFaceSet();if(i){let s=[],o=e.data?.family??vt(t),r=e.data?.weights?.filter(n=>mt.includes(n))??["normal"],a=e.data??{};for(let n=0;n<r.length;n++){let h=r[n],c=new FontFace(o,`url(${_t(t)})`,{...a,weight:h});await c.load(),i.add(c),s.push(c)}return O.set(o,{url:t,fontFaces:s}),s.length===1?s[0]:s}return A("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach(e=>{O.remove(e.family),m.ADAPTER.getFontFaceSet().delete(e)})}};var Et=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Tt=".svg",bt="image/svg+xml",Ve={extension:{type:d.LoadParser,priority:v.Low},name:"loadSVG",test(t){return P(t,bt)||x(t,Tt)},async testParse(t){return typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Et.test(t)},async parse(t){let e=new Fe;return e.svg(t),e},async load(t){return(await m.ADAPTER.fetch(t)).text()},unload(t){t.destroy(!0)}};function ee(t,e=1){let i=m.RETINA_PREFIX?.exec(t);return i?parseFloat(i[1]):e}var qe=0,de,Pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",xt={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${Pt}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},wt={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`},pe,me=class{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{let i=URL.createObjectURL(new Blob([xt.code],{type:"application/javascript"})),s=new Worker(i);s.addEventListener("message",o=>{s.terminate(),URL.revokeObjectURL(i),e(o.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){de===void 0&&(de=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<de&&(pe||(pe=URL.createObjectURL(new Blob([wt.code],{type:"application/javascript"}))),this._createdWorkers++,e=new Worker(pe),e.addEventListener("message",i=>{this._complete(i.data),this._returnWorker(i.target),this._next()})),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){e.error!==void 0?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),this._resolveHash[e.uuid]=null}async _run(e,i){await this._initWorkers();let s=new Promise((o,r)=>{this._queue.push({id:e,arguments:i,resolve:o,reject:r})});return this._next(),s}_next(){if(!this._queue.length)return;let e=this._getWorker();if(!e)return;let i=this._queue.pop(),s=i.id;this._resolveHash[qe]={resolve:i.resolve,reject:i.reject},e.postMessage({data:i.arguments,uuid:qe++,id:s})}},fe=new me;function te(t,e,i){let s=new I({source:t,label:i}),o=()=>{delete e.promiseCache[i],O.has(i)&&O.remove(i)};return s.once("destroy",()=>{i in e.promiseCache&&(A("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),o())}),s.source.once("destroy",()=>{t.destroyed||(A("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),o())}),s}var kt=[".jpeg",".jpg",".png",".webp",".avif"],Mt=["image/jpeg","image/png","image/webp","image/avif"];async function St(t){let e=await m.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);let i=await e.blob();return await createImageBitmap(i)}var ie={name:"loadTextures",extension:{type:d.LoadParser,priority:v.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(t){return P(t,Mt)||x(t,kt)},async load(t,e,i){let s=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await fe.isImageBitmapSupported()?s=await fe.loadImageBitmap(t):s=await St(t):s=await new Promise(r=>{s=new Image,s.crossOrigin=this.config.crossOrigin,s.src=t,s.complete?r(s):s.onload=()=>{r(s)}});let o=new Be({resource:s,alphaMode:"premultiply-alpha-on-upload",resolution:e.data?.resolution||ee(t),...e.data});return te(o,i,t)},unload(t){t.destroy(!0)}};var ge;async function se(){return ge??(ge=(async()=>{let e=document.createElement("canvas").getContext("webgl");if(!e)return"premultiply-alpha-on-upload";let i=await new Promise(a=>{let n=document.createElement("video");n.onloadeddata=()=>a(n),n.onerror=()=>a(null),n.autoplay=!1,n.crossOrigin="anonymous",n.preload="auto",n.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",n.load()});if(!i)return"premultiply-alpha-on-upload";let s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);let o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i);let r=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,r),e.deleteFramebuffer(o),e.deleteTexture(s),e.getExtension("WEBGL_lose_context")?.loseContext(),r[0]<=r[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),ge}var Ye=class extends le{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...Ye.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){let t=b.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;let t=this.resource;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(this.options.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this.alphaMode=await se(),this._load=new Promise((e,i)=>{this.isValid?e(this):(this._resolve=e,this._reject=i,t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){let t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){let t=this.resource;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();let t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(b.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(b.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(b.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}},D=Ye;D.defaultOptions={...le.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};D.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};var Ke=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],It=Ke.map(t=>`video/${t.substring(1)}`);function Bt(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=Ft(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}function Ft(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location;let i=new URL(t,document.baseURI);return i.hostname!==e.hostname||i.port!==e.port||i.protocol!==e.protocol?"anonymous":""}var $e={name:"loadVideo",extension:{type:d.LoadParser},config:null,test(t){let e=P(t,It),i=x(t,Ke);return e||i},async load(t,e,i){let s={...D.defaultOptions,resolution:e.data?.resolution||ee(t),alphaMode:e.data?.alphaMode||await se(),...e.data},o=document.createElement("video"),r={preload:s.autoLoad!==!1?"auto":void 0,"webkit-playsinline":s.playsinline!==!1?"":void 0,playsinline:s.playsinline!==!1?"":void 0,muted:s.muted===!0?"":void 0,loop:s.loop===!0?"":void 0,autoplay:s.autoPlay!==!1?"":void 0};Object.keys(r).forEach(c=>{let l=r[c];l!==void 0&&o.setAttribute(c,l)}),s.muted===!0&&(o.muted=!0),Bt(o,t,s.crossorigin);let a=document.createElement("source"),n;if(t.startsWith("data:"))n=t.slice(5,t.indexOf(";"));else if(!t.startsWith("blob:")){let c=t.split("?")[0].slice(t.lastIndexOf(".")+1).toLowerCase();n=D.MIME_TYPES[c]||`video/${c}`}a.src=t,n&&(a.type=n),o.appendChild(a);let h=new D({...s,resource:o});return te(h,i,t)},unload(t){t.destroy(!0)}};var Ze={extension:d.ResolveParser,test:ie.test,parse:t=>({resolution:parseFloat(m.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})};g.add(Oe,De,Ue,je,Ne,We,ze,He,Ge,Xe,Ve,ie,$e,Ze,Ce,Le);var Qe={loader:d.LoadParser,resolver:d.ResolveParser,cache:d.CacheParser,detection:d.DetectionParser};g.handle(d.Asset,t=>{let e=t.ref;Object.entries(Qe).filter(([i])=>!!e[i]).forEach(([i,s])=>g.add(Object.assign(e[i],{extension:e[i].extension??s})))},t=>{let e=t.ref;Object.keys(Qe).filter(i=>!!e[i]).forEach(i=>g.remove(e[i]))});var Ae=class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this._tickerAdded||!this.domElement||(b.system.add(this._tickerUpdate,this,F.INTERACTION),this._tickerAdded=!0)}removeTickerListener(){!this._tickerAdded||(b.system.remove(this._tickerUpdate,this),this._tickerAdded=!1)}pointerMoved(){this._didMove=!0}_update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}let e=this.events._rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}_tickerUpdate(e){this._deltaTime+=e.deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this._update())}},k=new Ae;var B=class extends ${constructor(){super(...arguments),this.client=new S,this.movement=new S,this.offset=new S,this.global=new S,this.screen=new S}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,i,s){return e.worldTransform.applyInverse(s||this.global,i)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,i,s,o,r,a,n,h,c,l,p,u,f,E,ye){throw new Error("Method not implemented.")}};var y=class extends B{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}};var M=class extends B{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}};M.DOM_DELTA_PIXEL=0;M.DOM_DELTA_LINE=1;M.DOM_DELTA_PAGE=2;var Lt=2048,Ct=new S,X=new S,oe=class{constructor(e){this.dispatch=new be,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,i){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:i,priority:0}),this.mappingTable[e].sort((s,o)=>s.priority-o.priority)}dispatchEvent(e,i){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,i),this.dispatch.emit(i||e.type,e)}mapEvent(e){if(!this.rootTarget)return;let i=this.mappingTable[e.type];if(i)for(let s=0,o=i.length;s<o;s++)i[s].fn(e);else A(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,i){k.pauseUpdate=!0;let o=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",r=this[o](this.rootTarget,this.rootTarget.eventMode,Ct.set(e,i),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(e,i){if(!e.target)return;let s=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let o=0,r=s.length-1;o<r;o++)if(e.currentTarget=s[o],this.notifyTarget(e,i),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,i),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let o=s.length-2;o>=0;o--)if(e.currentTarget=s[o],this.notifyTarget(e,i),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,i,s=this._allInteractiveElements){if(s.length===0)return;e.eventPhase=e.BUBBLING_PHASE;let o=Array.isArray(i)?i:[i];for(let r=s.length-1;r>=0;r--)o.forEach(a=>{e.currentTarget=s[r],this.notifyTarget(e,a)})}propagationPath(e){let i=[e];for(let s=0;s<Lt&&e!==this.rootTarget&&e.parent;s++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");i.push(e.parent),e=e.parent}return i.reverse(),i}hitTestMoveRecursive(e,i,s,o,r,a=!1){let n=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||i==="dynamic")&&(k.pauseUpdate=!1),e.interactiveChildren&&e.children){let l=e.children;for(let p=l.length-1;p>=0;p--){let u=l[p],f=this.hitTestMoveRecursive(u,this._isInteractive(i)?i:u.eventMode,s,o,r,a||r(e,s));if(f){if(f.length>0&&!f[f.length-1].parent)continue;let E=e.isInteractive();(f.length>0||E)&&(E&&this._allInteractiveElements.push(e),f.push(e)),this._hitElements.length===0&&(this._hitElements=f),n=!0}}}let h=this._isInteractive(i),c=e.isInteractive();return c&&c&&this._allInteractiveElements.push(e),a||this._hitElements.length>0?null:n?this._hitElements:h&&!r(e,s)&&o(e,s)?c?[e]:[]:null}hitTestRecursive(e,i,s,o,r){if(this._interactivePrune(e)||r(e,s))return null;if((e.eventMode==="dynamic"||i==="dynamic")&&(k.pauseUpdate=!1),e.interactiveChildren&&e.children){let h=e.children,c=s;for(let l=h.length-1;l>=0;l--){let p=h[l],u=this.hitTestRecursive(p,this._isInteractive(i)?i:p.eventMode,c,o,r);if(u){if(u.length>0&&!u[u.length-1].parent)continue;let f=e.isInteractive();return(u.length>0||f)&&u.push(e),u}}}let a=this._isInteractive(i),n=e.isInteractive();return a&&o(e,s)?n?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!e||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren}hitPruneFn(e,i){if(e.hitArea&&(e.worldTransform.applyInverse(i,X),!e.hitArea.contains(X.x,X.y)))return!0;if(e.effects&&e.effects.length)for(let s=0;s<e.effects.length;s++){let o=e.effects[s];if(o.containsPoint&&!o.containsPoint(i,this.hitTestFn))return!0}return!1}hitTestFn(e,i){return e.hitArea?!0:e.view?.containsPoint?(e.worldTransform.applyInverse(i,X),e.view.containsPoint(X)):!1}notifyTarget(e,i){i=i??e.type;let s=`on${i}`;e.currentTarget[s]?.(e);let o=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${i}capture`:i;this._notifyListeners(e,o),e.eventPhase===e.AT_TARGET&&this._notifyListeners(e,i)}mapPointerDown(e){if(!(e instanceof y)){A("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.createPointerEvent(e);if(this.dispatchEvent(i,"pointerdown"),i.pointerType==="touch")this.dispatchEvent(i,"touchstart");else if(i.pointerType==="mouse"||i.pointerType==="pen"){let o=i.button===2;this.dispatchEvent(i,o?"rightdown":"mousedown")}let s=this.trackingData(e.pointerId);s.pressTargetsByButton[e.button]=i.composedPath(),this.freeEvent(i)}mapPointerMove(e){if(!(e instanceof y)){A("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;let i=this.createPointerEvent(e);this._isPointerMoveEvent=!1;let s=i.pointerType==="mouse"||i.pointerType==="pen",o=this.trackingData(e.pointerId),r=this.findMountedTarget(o.overTargets);if(o.overTargets?.length>0&&r!==i.target){let h=e.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(e,h,r);if(this.dispatchEvent(c,"pointerout"),s&&this.dispatchEvent(c,"mouseout"),!i.composedPath().includes(r)){let l=this.createPointerEvent(e,"pointerleave",r);for(l.eventPhase=l.AT_TARGET;l.target&&!i.composedPath().includes(l.target);)l.currentTarget=l.target,this.notifyTarget(l),s&&this.notifyTarget(l,"mouseleave"),l.target=l.target.parent;this.freeEvent(l)}this.freeEvent(c)}if(r!==i.target){let h=e.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(i,h);this.dispatchEvent(c,"pointerover"),s&&this.dispatchEvent(c,"mouseover");let l=r?.parent;for(;l&&l!==this.rootTarget.parent&&l!==i.target;)l=l.parent;if(!l||l===this.rootTarget.parent){let u=this.clonePointerEvent(i,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==r&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),s&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(c)}let a=[],n=this.enableGlobalMoveEvents??!0;this.moveOnAll?a.push("pointermove"):this.dispatchEvent(i,"pointermove"),n&&a.push("globalpointermove"),i.pointerType==="touch"&&(this.moveOnAll?a.splice(1,0,"touchmove"):this.dispatchEvent(i,"touchmove"),n&&a.push("globaltouchmove")),s&&(this.moveOnAll?a.splice(1,0,"mousemove"):this.dispatchEvent(i,"mousemove"),n&&a.push("globalmousemove"),this.cursor=i.target?.cursor),a.length>0&&this.all(i,a),this._allInteractiveElements.length=0,this._hitElements.length=0,o.overTargets=i.composedPath(),this.freeEvent(i)}mapPointerOver(e){if(!(e instanceof y)){A("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.trackingData(e.pointerId),s=this.createPointerEvent(e),o=s.pointerType==="mouse"||s.pointerType==="pen";this.dispatchEvent(s,"pointerover"),o&&this.dispatchEvent(s,"mouseover"),s.pointerType==="mouse"&&(this.cursor=s.target?.cursor);let r=this.clonePointerEvent(s,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),o&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;i.overTargets=s.composedPath(),this.freeEvent(s),this.freeEvent(r)}mapPointerOut(e){if(!(e instanceof y)){A("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.trackingData(e.pointerId);if(i.overTargets){let s=e.pointerType==="mouse"||e.pointerType==="pen",o=this.findMountedTarget(i.overTargets),r=this.createPointerEvent(e,"pointerout",o);this.dispatchEvent(r),s&&this.dispatchEvent(r,"mouseout");let a=this.createPointerEvent(e,"pointerleave",o);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),s&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;i.overTargets=null,this.freeEvent(r),this.freeEvent(a)}this.cursor=null}mapPointerUp(e){if(!(e instanceof y)){A("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=performance.now(),s=this.createPointerEvent(e);if(this.dispatchEvent(s,"pointerup"),s.pointerType==="touch")this.dispatchEvent(s,"touchend");else if(s.pointerType==="mouse"||s.pointerType==="pen"){let n=s.button===2;this.dispatchEvent(s,n?"rightup":"mouseup")}let o=this.trackingData(e.pointerId),r=this.findMountedTarget(o.pressTargetsByButton[e.button]),a=r;if(r&&!s.composedPath().includes(r)){let n=r;for(;n&&!s.composedPath().includes(n);){if(s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch")this.notifyTarget(s,"touchendoutside");else if(s.pointerType==="mouse"||s.pointerType==="pen"){let h=s.button===2;this.notifyTarget(s,h?"rightupoutside":"mouseupoutside")}n=n.parent}delete o.pressTargetsByButton[e.button],a=n}if(a){let n=this.clonePointerEvent(s,"click");n.target=a,n.path=null,o.clicksByButton[e.button]||(o.clicksByButton[e.button]={clickCount:0,target:n.target,timeStamp:i});let h=o.clicksByButton[e.button];if(h.target===n.target&&i-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=n.target,h.timeStamp=i,n.detail=h.clickCount,n.pointerType==="mouse"){let c=n.button===2;this.dispatchEvent(n,c?"rightclick":"click")}else n.pointerType==="touch"&&this.dispatchEvent(n,"tap");this.dispatchEvent(n,"pointertap"),this.freeEvent(n)}this.freeEvent(s)}mapPointerUpOutside(e){if(!(e instanceof y)){A("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.trackingData(e.pointerId),s=this.findMountedTarget(i.pressTargetsByButton[e.button]),o=this.createPointerEvent(e);if(s){let r=s;for(;r;)o.currentTarget=r,this.notifyTarget(o,"pointerupoutside"),o.pointerType==="touch"?this.notifyTarget(o,"touchendoutside"):(o.pointerType==="mouse"||o.pointerType==="pen")&&this.notifyTarget(o,o.button===2?"rightupoutside":"mouseupoutside"),r=r.parent;delete i.pressTargetsByButton[e.button]}this.freeEvent(o)}mapWheel(e){if(!(e instanceof M)){A("EventBoundary cannot map a non-wheel event as a wheel event");return}let i=this.createWheelEvent(e);this.dispatchEvent(i),this.freeEvent(i)}findMountedTarget(e){if(!e)return null;let i=e[0];for(let s=1;s<e.length&&e[s].parent===i;s++)i=e[s];return i}createPointerEvent(e,i,s){let o=this.allocateEvent(y);return this.copyPointerData(e,o),this.copyMouseData(e,o),this.copyData(e,o),o.nativeEvent=e.nativeEvent,o.originalEvent=e,o.target=s??this.hitTest(o.global.x,o.global.y)??this._hitElements[0],typeof i=="string"&&(o.type=i),o}createWheelEvent(e){let i=this.allocateEvent(M);return this.copyWheelData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.nativeEvent=e.nativeEvent,i.originalEvent=e,i.target=this.hitTest(i.global.x,i.global.y),i}clonePointerEvent(e,i){let s=this.allocateEvent(y);return s.nativeEvent=e.nativeEvent,s.originalEvent=e.originalEvent,this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.target=e.target,s.path=e.composedPath().slice(),s.type=i??s.type,s}copyWheelData(e,i){i.deltaMode=e.deltaMode,i.deltaX=e.deltaX,i.deltaY=e.deltaY,i.deltaZ=e.deltaZ}copyPointerData(e,i){e instanceof y&&i instanceof y&&(i.pointerId=e.pointerId,i.width=e.width,i.height=e.height,i.isPrimary=e.isPrimary,i.pointerType=e.pointerType,i.pressure=e.pressure,i.tangentialPressure=e.tangentialPressure,i.tiltX=e.tiltX,i.tiltY=e.tiltY,i.twist=e.twist)}copyMouseData(e,i){e instanceof B&&i instanceof B&&(i.altKey=e.altKey,i.button=e.button,i.buttons=e.buttons,i.client.copyFrom(e.client),i.ctrlKey=e.ctrlKey,i.metaKey=e.metaKey,i.movement.copyFrom(e.movement),i.screen.copyFrom(e.screen),i.shiftKey=e.shiftKey,i.global.copyFrom(e.global))}copyData(e,i){i.isTrusted=e.isTrusted,i.srcElement=e.srcElement,i.timeStamp=performance.now(),i.type=e.type,i.detail=e.detail,i.view=e.view,i.which=e.which,i.layer.copyFrom(e.layer),i.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);let i=this.eventPool.get(e).pop()||new e(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=null,i.target=null,i}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");let i=e.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),this.eventPool.get(i).push(e)}_notifyListeners(e,i){let s=e.currentTarget._events[i];if(!!s&&!!e.currentTarget.isInteractive())if("fn"in s)s.once&&e.currentTarget.removeListener(i,s.fn,void 0,!0),s.fn.call(s.context,e);else for(let o=0,r=s.length;o<r&&!e.propagationImmediatelyStopped;o++)s[o].once&&e.currentTarget.removeListener(i,s[o].fn,void 0,!0),s[o].fn.call(s[o].context,e)}};var Ot=1,Ut={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ve=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new oe(null),k.init(this),this.autoPreventDefault=!0,this._eventsAdded=!1,this._rootPointerEvent=new y(null),this._rootWheelEvent=new M(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...ve.defaultEventFeatures},{set:(e,i,s)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),e[i]=s,!0)}),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerUp=this._onPointerUp.bind(this),this._onPointerOverOut=this._onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){let{canvas:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,ve._defaultEventMode=t.eventMode??"passive",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null,this._currentCursor=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this._currentCursor===t)return;this._currentCursor=t;let i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this._rootPointerEvent}_onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=this._normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,s=e.length;i<s;i++){let o=e[i],r=this._bootstrapEvent(this._rootPointerEvent,o);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}_onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,k.pointerMoved();let e=this._normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){let o=this._bootstrapEvent(this._rootPointerEvent,e[i]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}_onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);let i=e!==this.domElement?"outside":"",s=this._normalizeToPointerData(t);for(let o=0,r=s.length;o<r;o++){let a=this._bootstrapEvent(this._rootPointerEvent,s[o]);a.type+=i,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}_onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=this._normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){let o=this._bootstrapEvent(this._rootPointerEvent,e[i]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;let e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this._removeEvents(),this.domElement=t,k.domElement=t,this._addEvents()}_addEvents(){if(this._eventsAdded||!this.domElement)return;k.addTickerListener();let t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this._onPointerMove,!0),this.domElement.addEventListener("pointerdown",this._onPointerDown,!0),this.domElement.addEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this._onPointerOverOut,!0),globalThis.addEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this._onPointerMove,!0),this.domElement.addEventListener("mousedown",this._onPointerDown,!0),this.domElement.addEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this._onPointerOverOut,!0),globalThis.addEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this._onPointerDown,!0),this.domElement.addEventListener("touchend",this._onPointerUp,!0),this.domElement.addEventListener("touchmove",this._onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this._eventsAdded=!0}_removeEvents(){if(!this._eventsAdded||!this.domElement)return;k.removeTickerListener();let t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this._onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this._onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this._onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this._onPointerMove,!0),this.domElement.removeEventListener("mousedown",this._onPointerDown,!0),this.domElement.removeEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this._onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this._onPointerDown,!0),this.domElement.removeEventListener("touchend",this._onPointerUp,!0),this.domElement.removeEventListener("touchmove",this._onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this._eventsAdded=!1}mapPositionToPoint(t,e,i){let s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},o=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*o,t.y=(i-s.top)*(this.domElement.height/s.height)*o}_normalizeToPointerData(t){let e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,s=t.changedTouches.length;i<s;i++){let o=t.changedTouches[i];typeof o.button>"u"&&(o.button=0),typeof o.buttons>"u"&&(o.buttons=1),typeof o.isPrimary>"u"&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,e.push(o)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){let i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=Ot),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){let e=this._rootWheelEvent;return this._transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}_bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this._transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Ut[t.type]||t.type),t}_transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}},N=ve;N.extension={name:"events",type:[d.WebGLSystem,d.CanvasSystem,d.WebGPUSystem],priority:-1};N.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};var Je={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return this.eventMode==="dynamic"||this.eventMode==="static"},set interactive(t){this.eventMode=t?"static":"passive"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??N.defaultEventMode},set eventMode(t){this._internalEventMode=t},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(t,e,i){let s=typeof i=="boolean"&&i||typeof i=="object"&&i.capture,o=typeof e=="function"?void 0:e;t=s?`${t}capture`:t,e=typeof e=="function"?e:e.handleEvent,this.on(t,e,o)},removeEventListener(t,e,i){let s=typeof i=="boolean"&&i||typeof i=="object"&&i.capture,o=typeof e=="function"?void 0:e;t=s?`${t}capture`:t,e=typeof e=="function"?e:e.handleEvent,this.off(t,e,o)},dispatchEvent(t){if(!(t instanceof $))throw new Error("Container cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};g.add(N);C.mixin(Je);var V=class{constructor(t,e){this.linkedSheets=[],this._texture=t instanceof I?t:null,this.textureSource=t.source,this.textures={},this.animations={},this.data=e;let i=parseFloat(e.meta.scale);i?(this.resolution=i,t.source.resolution=this.resolution):this.resolution=t.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=V.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t,i=V.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){let s=this._frameKeys[e],o=this._frames[s],r=o.frame;if(r){let a=null,n=null,h=o.trimmed!==!1&&o.sourceSize?o.sourceSize:o.frame,c=new L(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);o.rotated?a=new L(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):a=new L(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),o.trimmed!==!1&&o.spriteSourceSize&&(n=new L(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),n.x/=this.textureSource.width,n.y/=this.textureSource.height,n.width/=this.textureSource.width,n.height/=this.textureSource.height),a.x/=this.textureSource.width,a.y/=this.textureSource.height,a.width/=this.textureSource.width,a.height/=this.textureSource.height,c.x/=this.textureSource.width,c.y/=this.textureSource.height,c.width/=this.textureSource.width,c.height/=this.textureSource.height,this.textures[s]=new I({source:this.textureSource,layout:{frame:a,orig:c,trim:n,rotate:o.rotated?2:0,defaultAnchor:o.anchor,defaultBorders:o.borders},label:s.toString()})}e++}}_processAnimations(){let t=this.data.animations||{};for(let e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){let s=t[e][i];this.animations[e].push(this.textures[s])}}}_parseComplete(){let t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*V.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*V.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(let e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}},re=V;re.BATCH_SIZE=1e3;var Rt=["jpg","png","jpeg","avif","webp"];function et(t,e,i){let s={};if(t.forEach(o=>{s[o]=e}),Object.keys(e.textures).forEach(o=>{s[o]=e.textures[o]}),!i){let o=_.dirname(t[0]);e.linkedSheets.forEach((r,a)=>{let n=et([`${o}/${e.data.meta.related_multi_packs[a]}`],r,!0);Object.assign(s,n)})}return s}var tt={extension:d.Asset,cache:{test:t=>t instanceof re,getCacheableAssets:(t,e)=>et(t,e,!1)},resolver:{test:t=>{let i=t.split("?")[0].split("."),s=i.pop(),o=i.pop();return s==="json"&&Rt.includes(o)},parse:t=>{let e=t.split(".");return{resolution:parseFloat(m.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:d.LoadParser,priority:v.Normal},async testParse(t,e){return _.extname(e.src).toLowerCase()===".json"&&!!t.frames},async parse(t,e,i){let s=_.dirname(e.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");let o=s+t.meta.image;o=j(o,e.src);let a=(await i.load([o]))[o],n=new re(a.source,t);await n.parse();let h=t?.meta?.related_multi_packs;if(Array.isArray(h)){let c=[];for(let p of h){if(typeof p!="string")continue;let u=s+p;e.data?.ignoreMultiPack||(u=j(u,e.src),c.push(i.load({src:u,data:{ignoreMultiPack:!0}})))}let l=await Promise.all(c);n.linkedSheets=l,l.forEach(p=>{p.linkedSheets=[n].concat(n.linkedSheets.filter(u=>u!==p))})}return n},unload(t){t.destroy(!0)}}};g.add(tt);var Dt=new Z;function ne(t,e,i){let s=Dt;t.measurable=!0,we(t,i,s),e.addBoundsMask(s),t.measurable=!1}function ae(t,e,i){let s=new Z;t.measurable=!0;let o=it(t,i,new Pe);ke(t,s,o),t.measurable=!1,e.addBoundsMask(s)}function it(t,e,i){return t?(t!==e&&(it(t.parent,e,i),t.didChange&&xe(t.localTransform,t),i.append(t.localTransform)),i):(A("Item is not inside the root container"),i)}var q=class{constructor(e){this.priority=0,this.pipe="alphaMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.renderMaskToTexture=!(e instanceof he),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(e,i){ne(this.mask,e,i)}addLocalBounds(e,i){ae(this.mask,e,i)}containsPoint(e,i){let s=this.mask;return i(s,e)}destroy(){this.reset()}static test(e){return e instanceof he}};q.extension=d.MaskEffect;var Y=class{constructor(e){this.priority=0,this.pipe="colorMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e}destroy(){}static test(e){return typeof e=="number"}};Y.extension=d.MaskEffect;var K=class{constructor(e){this.priority=0,this.pipe="stencilMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(e,i){ne(this.mask,e,i)}addLocalBounds(e,i){ae(this.mask,e,i)}containsPoint(e,i){let s=this.mask;return i(s,e)}destroy(){this.reset()}static test(e){return e instanceof C}};K.extension=d.MaskEffect;g.add(q,Y,K);g.add(Se);C.mixin(Me);export{_ as a,N as b};
