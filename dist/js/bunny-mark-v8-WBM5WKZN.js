import{a as v,b as B}from"./chunk-XA2AIM77.js";import"./chunk-KFBPQZS2.js";import"./chunk-DVPSPQXD.js";import"./chunk-Z4UU6YWC.js";import{a as z}from"./chunk-WLHTQZBF.js";import{A as l,B as b,D as C,Q as U,c as P,d as k,m as L,q as c,w as R,z as y}from"./chunk-MPTJJU46.js";import{c as N}from"./chunk-5GOQA2B2.js";var O;function V(){return typeof O>"u"&&(O=function(){let e={stencil:!0,failIfMajorPerformanceCaveat:y.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!y.ADAPTER.getWebGLRenderingContext())return!1;let t=y.ADAPTER.createCanvas().getContext("webgl2",e),o=!!t?.getContextAttributes()?.stencil;if(t){let s=t.getExtension("WEBGL_lose_context");s&&s.loseContext()}return t=null,o}catch{return!1}}()),O}async function W(m={}){if(!y.ADAPTER.getNavigator().gpu)return!1;try{return await(await navigator.gpu.requestAdapter(m)).requestDevice(),!0}catch{return!1}}var H=["webgpu","webgl","canvas"];async function D(m){let e=[];m.preference?(e.push(m.preference),H.forEach(s=>{s!==m.preference&&e.push(s)})):e=H.slice();let r;(m.manageImports??!0)&&await import("./all-MPFX4QOR.js");let t={};for(let s=0;s<e.length;s++){let i=e[s];if(i==="webgpu"&&await W()){let{WebGPURenderer:a}=await import("./WebGPURenderer-EAQE6Q6B.js");r=a,t={...m,...m.webgpu};break}else if(i==="webgl"&&V()){let{WebGLRenderer:a}=await import("./WebGLRenderer-R7AII7SW.js");r=a,t={...m,...m.webgl};break}else if(i==="canvas"){t={...m};break}}delete t.webgpu,delete t.webgl;let o=new r;return await o.init(t),o}var A=class{constructor(e,r=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=r}add(e){e.forEach(r=>{this._assetList.push(r)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let e=[],r=Math.min(this._assetList.length,this._maxConcurrent);for(let t=0;t<r;t++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}};var _=m=>!Array.isArray(m);var G=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,r,t)=>(this._parsersValidated=!1,e[r]=t,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,r){let t={promise:null,parser:null};return t.promise=(async()=>{let o=null,s=null;if(r.loadParser&&(s=this._parserHash[r.loadParser],s||c(`[Assets] specified load parser "${r.loadParser}" not found while loading ${e}`)),!s){for(let i=0;i<this.parsers.length;i++){let a=this.parsers[i];if(a.load&&a.test?.(e,r,this)){s=a;break}}if(!s)return c(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}o=await s.load(e,r,this),t.parser=s;for(let i=0;i<this.parsers.length;i++){let a=this.parsers[i];a.parse&&a.parse&&await a.testParse?.(o,r,this)&&(o=await a.parse(o,r,this)||o,t.parser=a)}return o})(),t}async load(e,r){this._parsersValidated||this._validateParsers();let t=0,o={},s=_(e),i=l(e,f=>({alias:[f],src:f})),a=i.length,n=i.map(async f=>{let p=v.toAbsolute(f.src);if(!o[f.src])try{this.promiseCache[p]||(this.promiseCache[p]=this._getLoadPromiseAndParser(p,f)),o[f.src]=await this.promiseCache[p].promise,r&&r(++t/a)}catch(x){throw delete this.promiseCache[p],delete o[f.src],new Error(`[Loader.load] Failed to load ${p}.
${x}`)}});return await Promise.all(n),s?o[i[0].src]:o}async unload(e){let t=l(e,o=>({alias:[o],src:o})).map(async o=>{let s=v.toAbsolute(o.src),i=this.promiseCache[s];if(i){let a=await i.promise;delete this.promiseCache[s],i.parser?.unload?.(a,o,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,r)=>(r.name?e[r.name]&&c(`[Assets] loadParser name conflict "${r.name}"`):c("[Assets] loadParser should have a name"),{...e,[r.name]:r}),{})}};function j(m,e,r,t,o){let s=e[r];for(let i=0;i<s.length;i++){let a=s[i];r<e.length-1?j(m.replace(t[r],a),e,r+1,t,o):o.push(m.replace(t[r],a))}}function $(m){let e=/\{(.*?)\}/g,r=m.match(e),t=[];if(r){let o=[];r.forEach(s=>{let i=s.substring(1,s.length-1).split(",");o.push(i)}),j(m,o,0,r,t)}else t.push(m);return t}var F=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,r)=>`${e}${this._bundleIdConnector}${r}`,extractAssetIdFromBundle:(e,r)=>r.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{let r=e;this._defaultSearchParams=Object.keys(r).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(r[t])}`).join("&")}}getAlias(e){let{alias:r,name:t,src:o,srcs:s}=e;return l(r||t||o||s,a=>typeof a=="string"?a:Array.isArray(a)?a.map(n=>n?.src??n?.srcs??n):a?.src||a?.srcs?a.src??a.srcs:a,!0)}addManifest(e){this._manifest&&c("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(e,r){let t=[];Array.isArray(r)?r.forEach(o=>{let s=o.src??o.srcs,i=o.alias??o.name,a;if(typeof i=="string"){let n=this._createBundleAssetId(e,i);t.push(n),a=[i,n]}else{let n=i.map(f=>this._createBundleAssetId(e,f));t.push(...n),a=[...i,...n]}this.add({...o,alias:a,src:s})}):Object.keys(r).forEach(o=>{let s=[o,this._createBundleAssetId(e,o)];if(typeof r[o]=="string")this.add({alias:s,src:r[o]});else if(Array.isArray(r[o]))this.add({alias:s,src:r[o]});else{let i=r[o],a=i.src??i.srcs;this.add({...i,alias:s,src:Array.isArray(a)?a:[a]})}t.push(...s)}),this._bundles[e]=t}add(e){let r=[];Array.isArray(e)?r.push(...e):r.push(e);let t;t=s=>{this.hasKey(s)&&c(`[Resolver] already has key: ${s} overwriting`)},l(r).forEach(s=>{let{src:i,srcs:a}=s,{data:n,format:f,loadParser:p}=s,x=l(i||a).map(u=>typeof u=="string"?$(u):Array.isArray(u)?u:[u]),d=this.getAlias(s);Array.isArray(d)?d.forEach(t):t(d);let T=[];x.forEach(u=>{u.forEach(h=>{let g={};if(typeof h!="object"){g.src=h;for(let M=0;M<this._parsers.length;M++){let I=this._parsers[M];if(I.test(h)){g=I.parse(h);break}}}else n=h.data??n,f=h.format??f,p=h.loadParser??p,g={...g,...h};if(!d)throw new Error(`[Resolver] alias is undefined for this asset: ${g.src}`);g=this._buildResolvedAsset(g,{aliases:d,data:n,format:f,loadParser:p}),T.push(g)})}),d.forEach(u=>{this._assetMap[u]=T})})}resolveBundle(e){let r=_(e);e=l(e);let t={};return e.forEach(o=>{let s=this._bundles[o];if(s){let i=this.resolve(s),a={};for(let n in i){let f=i[n];a[this._extractAssetIdFromBundle(o,n)]=f}t[o]=a}}),r?t[e[0]]:t}resolveUrl(e){let r=this.resolve(e);if(typeof e!="string"){let t={};for(let o in r)t[o]=r[o].src;return t}return r.src}resolve(e){let r=_(e);e=l(e);let t={};return e.forEach(o=>{if(!this._resolverHash[o])if(this._assetMap[o]){let s=this._assetMap[o],i=s[0],a=this._getPreferredOrder(s);a?.priority.forEach(n=>{a.params[n].forEach(f=>{let p=s.filter(x=>x[n]?x[n]===f:!1);p.length&&(s=p)})}),this._resolverHash[o]=s[0]??i}else this._resolverHash[o]=this._buildResolvedAsset({alias:[o],src:o},{});t[o]=this._resolverHash[o]}),r?t[e[0]]:t}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let r=0;r<e.length;r++){let t=e[0],o=this._preferredOrder.find(s=>s.params.format.includes(t.format));if(o)return o}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;let r=/\?/.test(e)?"&":"?";return`${e}${r}${this._defaultSearchParams}`}_buildResolvedAsset(e,r){let{aliases:t,data:o,loadParser:s,format:i}=r;return(this._basePath||this._rootPath)&&(e.src=v.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=t??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...o||{},...e.data},e.loadParser=s??e.loadParser,e.format=i??e.src.split(".").pop(),e.srcs=e.src,e.name=e.alias,e}};var w=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new F,this.loader=new G,this.cache=b,this._backgroundLoader=new A(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){c("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let s=e.manifest;typeof s=="string"&&(s=await this.load(s)),this.resolver.addManifest(s)}let r=e.texturePreference?.resolution??1,t=typeof r=="number"?[r]:r,o=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:o,resolution:t}}),e.preferences&&this.setPreferences(e.preferences)}add(e){this.resolver.add(e)}async load(e,r){this._initialized||await this.init();let t=_(e),o=l(e).map(a=>{if(typeof a!="string"){let n=this.resolver.getAlias(a);return n.some(f=>!this.resolver.hasKey(f))&&this.add(a),Array.isArray(n)?n[0]:n}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),s=this.resolver.resolve(o),i=await this._mapLoadToResolve(s,r);return t?i[o[0]]:i}addBundle(e,r){this.resolver.addBundle(e,r)}async loadBundle(e,r){this._initialized||await this.init();let t=!1;typeof e=="string"&&(t=!0,e=[e]);let o=this.resolver.resolveBundle(e),s={},i=Object.keys(o),a=0,n=0,f=()=>{r?.(++a/n)},p=i.map(x=>{let d=o[x];return n+=Object.keys(d).length,this._mapLoadToResolve(d,f).then(T=>{s[x]=T})});return await Promise.all(p),t?s[e[0]]:s}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);let r=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(r))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);let r=this.resolver.resolveBundle(e);Object.values(r).forEach(t=>{this._backgroundLoader.add(Object.values(t))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return b.get(e);let r={};for(let t=0;t<e.length;t++)r[t]=b.get(e[t]);return r}async _mapLoadToResolve(e,r){let t=Object.values(e),o=Object.keys(e);this._backgroundLoader.active=!1;let s=await this.loader.load(t,r);this._backgroundLoader.active=!0;let i={};return t.forEach((a,n)=>{let f=s[a.src],p=[a.src];a.alias&&p.push(...a.alias),i[o[n]]=f,b.set(p,f)}),i}async unload(e){this._initialized||await this.init();let r=l(e).map(o=>typeof o!="string"?o.src:o),t=this.resolver.resolve(r);await this._unloadFromResolved(t)}async unloadBundle(e){this._initialized||await this.init(),e=l(e);let r=this.resolver.resolveBundle(e),t=Object.keys(r).map(o=>this._unloadFromResolved(r[o]));await Promise.all(t)}async _unloadFromResolved(e){let r=Object.values(e);r.forEach(t=>{b.remove(t.src)}),await this.loader.unload(r)}async _detectFormats(e){let r=[];e.preferredFormats&&(r=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(let t of e.detections)e.skipDetections||await t.test()?r=await t.add(r):e.skipDetections||(r=await t.remove(r));return r=r.filter((t,o)=>r.indexOf(t)===o),r}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach(r=>{!r.config||Object.keys(r.config).filter(t=>t in e).forEach(t=>{r.config[t]=e[t]})})}},S=new w;k.handleByList(P.LoadParser,S.loader.parsers).handleByList(P.ResolveParser,S.resolver.parsers).handleByList(P.CacheParser,S.cache.parsers).handleByList(P.DetectionParser,S.detections);var X=N(z(),1);var E=class{constructor(e,r){this.gravity=.75;this.speedX=Math.random()*10;this.speedY=Math.random()*10-5;this.positionX=0;this.positionY=0;this.view=new U(e),this.view.anchor.set(.5,1),this.bounds=r}update(){let e=this.positionX,r=this.positionY;e+=this.speedX,r+=this.speedY,this.speedY+=this.gravity,e>this.bounds.right?(this.speedX*=-1,e=this.bounds.right):e<this.bounds.left&&(this.speedX*=-1,e=this.bounds.left),r>this.bounds.bottom?(this.speedY*=-.85,r=this.bounds.bottom,Math.random()>.5&&(this.speedY-=Math.random()*6)):r<this.bounds.top&&(this.speedY=0,r=this.bounds.top),this.view.position.x=this.positionX=e,this.view.position.y=this.positionY=r}reset(){this.positionX=0,this.positionY=0}};C.defaultOptions.scaleMode="nearest";B.defaultEventFeatures.move=!1;B.defaultEventFeatures.globalMove=!1;var Y=[];async function Qe({totalBunnies:m,preference:e}){let r=await D({preference:e,clearBeforeRender:!0,backgroundAlpha:1,backgroundColor:16777215,width:800,height:600,resolution:1,antialias:!1,hello:!0});document.body.appendChild(r.view.canvas);let t=new R,o=Object.values(await S.load(["./assets/bunnies/rabbitv3_ash.png","./assets/bunnies/rabbitv3_batman.png","./assets/bunnies/rabbitv3_bb8.png","./assets/bunnies/rabbitv3_frankenstein.png","./assets/bunnies/rabbitv3_neo.png","./assets/bunnies/rabbitv3_sonic.png","./assets/bunnies/rabbitv3_spidey.png","./assets/bunnies/rabbitv3_stormtrooper.png","./assets/bunnies/rabbitv3_superman.png","./assets/bunnies/rabbitv3_tron.png","./assets/bunnies/rabbitv3_wolverine.png","./assets/bunnies/rabbitv3.png"])),s=new L(0,0,800,600),i=[];function a(){let p=Y.pop()||new E(o[i.length%o.length],s);p.reset(),t.addChild(p.view),i.push(p)}for(let p=0;p<m;p++)a();let n=!1;r.view.canvas.addEventListener("mousedown",()=>{n=!n});function f(){if(!n)for(let p=0;p<i.length;p++)i[p].update();r.render(t),requestAnimationFrame(f)}f()}export{Qe as bunnyMarkV8};
